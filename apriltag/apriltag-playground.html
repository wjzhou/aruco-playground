<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<script src="https://unpkg.com/pdf-lib@1.16.0/dist/pdf-lib.min.js"></script>
	<script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
	<script type="module" src="./apriltag-playground.js"></script>
	<title>Apriltag/Aruco playground</title>
</head>

<body>
	<textarea id="input" style="border: 1px solid black; width: 100%; height:25rem" spellcheck="false">
#72 for inch and 2.83464566929 for mm
unit: 72
paperSize: [8.5, 11]
# allowed value: [apriltag_36h11, apriltag_36h10, apriltag_25h9, apriltag_16h5, aruco_original, aruco_4x4, aruco_5x5, aruco_6x6, aruco_7x7]
dict: apriltag_36h11
layout:
# !tag id, x, y, size
# Note: id can be a number 
#  or -1, which will use the passed in id, 
#  or any javascript expression that have id as param, e.g. id+1
- !tag [-1, 0.625, 2, 7]

# !mark [x, y, radius]
- !mark [4.25, 10, 0.25]
- !mark [7.25, 10, 0.25]
- !mark [1.25, 10, 0.25]

# !text ["Id: ${id}", x, y, size, rotate (optional)]
# Note: text run through Template, which accept a id param
- !text ["Id: ${id}", 3, 9, 1]

# in the form of number or start-end, the id will be passed to layout
pages: !range 0,5-6</textarea><br>
	<button type="button" id='submit' style="margin:1rem 0">Submit</button><br>
	<embed id="pdf" type="application/pdf" frameBorder="0" scrolling="auto" height="1056" width="816"></embed>
	<script>
		/**
		 * @param {CanvasRenderingContext2D} ctx 
		 * @param {string} line
		 */
		function processLine(ctx, line) {
			line = line.trim();
			if (line.startsWith('#') || line.length === 0) {
				return;
			}
			const matches = line.match(/^([A-Z][A-D]?)(\d\d?)(?:.(\d))?\s+([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)\s+([0-9]*\.?[0-9]+)$/);
			if (!matches) {
				throw new Error(`can not parse: ${line}`)
			}
			let a1 = 0
			const aislePart = matches[1];
			a1 = aislePart.charCodeAt(0) - 'A'.charCodeAt(0)
			if (aislePart.length === 2) {
				a1 = 26 + aislePart.charCodeAt(1) - 'A'.charCodeAt(0)
			}
			const bayPart = matches[2];
			const a2 = +bayPart + 30;
			if (a2 >= 80) {
				throw new Error(`position part larger than 50 ${bayPart}, line: ${line}`);
			}
			const positionPart = matches[3];
			let a3
			if (positionPart) {
				a3 = +positionPart + 80;
			}

			const x = +matches[4];
			const y = +matches[5];
			const size = +matches[6];

			drawAruco(ctx, a1, x, y, size)
			drawAruco(ctx, a2, x + size * 1.2, y, size);
			if (a3 !== undefined) {
				drawAruco(ctx, a3, x + size * 1.2 * 2, y, size)
			}
		}
	</script>
</body>
</html>